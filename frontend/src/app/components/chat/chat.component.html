<div class="chat">
  <div
    class="chat-details {{ displayUserButton && isConnect ? 'show' : 'hide' }}"
  >
    <div class="users-container">
      <div class="filter-container">
        <input
          type="text"
          placeholder="Rechercher..."
          [(ngModel)]="filterInput"
          (ngModelChange)="setUserOnlineFilteredHandler(userOnlineArray)"
        />
      </div>
      <div
        class="user-list {{ userOnlineFiltered.length == 0 ? 'empty' : '' }}"
      >
        <ng-container *ngIf="userOnlineFiltered.length > 0; else noUserConnect">
          <app-chatuser
            *ngFor="let user of userOnlineFiltered"
            (createRoom)="!createGroupButton && createRoom($event)"
            [checkBox]="createGroupButton"
            [user]="user"
            (addUser)="addUserHandler($event)"
          ></app-chatuser>
        </ng-container>
        <ng-template #noUserConnect>
          <h4>Aucun utilisateur</h4>
        </ng-template>
      </div>
    </div>
    <div class="rooms-details">
      <div class="user-disconnect" *ngIf="!isConnect; else displayRoomsDetails">
        <button (click)="setUserConnectHandler()" class="connect">
          Connexion
        </button>
      </div>
      <ng-template #displayRoomsDetails>
        <div class="infos-container">
          <h3>{{ currentUser.name }}</h3>
          <button (click)="setUserDisconnectHandler()" class="disconnect">
            Déconnexion
          </button>
        </div>
        <div class="rooms-container {{ rooms.length > 0 ? '' : 'empty' }}">
          <ng-container *ngIf="rooms.length > 0; else noRoom">
            <app-chatroom
              *ngFor="let room of rooms"
              [currentUser]="currentUser"
              [room]="room"
              [active]="currentRoom && currentRoom.roomId === room.roomId"
              (setCurrentRoom)="setCurrentRoom($event)"
            ></app-chatroom>
          </ng-container>
          <ng-template #noRoom>
            <h4>Aucune salle</h4>
          </ng-template>
        </div>
        <div class="button-container">
          <button
            class="square contact {{ displayUserButton ? 'active' : '' }}"
            title="Liste de contact(s)"
            (click)="displayUserButtonHandler()"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M14.81 12.28C15.443 11.6002 15.7996 10.7088 15.81 9.78C15.81 8.77748 15.4118 7.81602 14.7029 7.10714C13.994 6.39825 13.0325 6 12.03 6C11.0275 6 10.066 6.39825 9.35714 7.10714C8.64825 7.81602 8.25 8.77748 8.25 9.78C8.26044 10.7088 8.61702 11.6002 9.25 12.28C8.36865 12.7189 7.61022 13.3699 7.04292 14.1746C6.47561 14.9793 6.11723 15.9124 6 16.89C5.97083 17.1552 6.0482 17.4212 6.21511 17.6293C6.38202 17.8375 6.62478 17.9708 6.89 18C7.15522 18.0292 7.42116 17.9518 7.62932 17.7849C7.83749 17.618 7.97083 17.3752 8 17.11C8.11933 16.1411 8.58885 15.2494 9.32009 14.6027C10.0513 13.956 10.9938 13.599 11.97 13.599C12.9462 13.599 13.8887 13.956 14.6199 14.6027C15.3512 15.2494 15.8207 16.1411 15.94 17.11C15.9678 17.3664 16.0936 17.6022 16.2911 17.768C16.4887 17.9339 16.7426 18.017 17 18H17.11C17.3721 17.9698 17.6117 17.8373 17.7766 17.6313C17.9414 17.4252 18.0181 17.1624 17.99 16.9C17.8815 15.9276 17.5344 14.997 16.9796 14.191C16.4248 13.3851 15.6796 12.7286 14.81 12.28ZM12 11.56C11.6479 11.56 11.3038 11.4556 11.0111 11.26C10.7184 11.0644 10.4902 10.7864 10.3555 10.4612C10.2208 10.1359 10.1855 9.77803 10.2542 9.43274C10.3229 9.08745 10.4924 8.77029 10.7414 8.52135C10.9903 8.27241 11.3075 8.10288 11.6527 8.0342C11.998 7.96552 12.3559 8.00077 12.6812 8.13549C13.0064 8.27022 13.2844 8.49837 13.48 8.79109C13.6756 9.0838 13.78 9.42795 13.78 9.78C13.78 10.2521 13.5925 10.7048 13.2586 11.0387C12.9248 11.3725 12.4721 11.56 12 11.56ZM19 2H5C4.20435 2 3.44129 2.31607 2.87868 2.87868C2.31607 3.44129 2 4.20435 2 5V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V5C22 4.20435 21.6839 3.44129 21.1213 2.87868C20.5587 2.31607 19.7956 2 19 2ZM20 19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V5C4 4.73478 4.10536 4.48043 4.29289 4.29289C4.48043 4.10536 4.73478 4 5 4H19C19.2652 4 19.5196 4.10536 19.7071 4.29289C19.8946 4.48043 20 4.73478 20 5V19Z"
                fill="black"
              />
            </svg>
          </button>
          <button
            class="square create-groupe {{ createGroupButton ? 'active' : '' }}"
            title="Créer un groupe"
            (click)="displayGroupInputHandler()"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M12.3 12.22C12.8336 11.7581 13.2616 11.1869 13.5549 10.545C13.8482 9.90316 14 9.20571 14 8.5C14 7.17392 13.4732 5.90215 12.5355 4.96447C11.5979 4.02678 10.3261 3.5 9 3.5C7.67392 3.5 6.40215 4.02678 5.46447 4.96447C4.52678 5.90215 4 7.17392 4 8.5C3.99999 9.20571 4.1518 9.90316 4.44513 10.545C4.73845 11.1869 5.16642 11.7581 5.7 12.22C4.30014 12.8539 3.11247 13.8775 2.27898 15.1685C1.4455 16.4596 1.00147 17.9633 1 19.5C1 19.7652 1.10536 20.0196 1.29289 20.2071C1.48043 20.3946 1.73478 20.5 2 20.5C2.26522 20.5 2.51957 20.3946 2.70711 20.2071C2.89464 20.0196 3 19.7652 3 19.5C3 17.9087 3.63214 16.3826 4.75736 15.2574C5.88258 14.1321 7.4087 13.5 9 13.5C10.5913 13.5 12.1174 14.1321 13.2426 15.2574C14.3679 16.3826 15 17.9087 15 19.5C15 19.7652 15.1054 20.0196 15.2929 20.2071C15.4804 20.3946 15.7348 20.5 16 20.5C16.2652 20.5 16.5196 20.3946 16.7071 20.2071C16.8946 20.0196 17 19.7652 17 19.5C16.9985 17.9633 16.5545 16.4596 15.721 15.1685C14.8875 13.8775 13.6999 12.8539 12.3 12.22ZM9 11.5C8.40666 11.5 7.82664 11.3241 7.33329 10.9944C6.83994 10.6648 6.45542 10.1962 6.22836 9.64805C6.0013 9.09987 5.94189 8.49667 6.05764 7.91473C6.1734 7.33279 6.45912 6.79824 6.87868 6.37868C7.29824 5.95912 7.83279 5.6734 8.41473 5.55764C8.99667 5.44189 9.59987 5.5013 10.1481 5.72836C10.6962 5.95542 11.1648 6.33994 11.4944 6.83329C11.8241 7.32664 12 7.90666 12 8.5C12 9.29565 11.6839 10.0587 11.1213 10.6213C10.5587 11.1839 9.79565 11.5 9 11.5ZM18.74 11.82C19.38 11.0993 19.798 10.2091 19.9438 9.25634C20.0896 8.30362 19.9569 7.32907 19.5618 6.45C19.1666 5.57093 18.5258 4.8248 17.7165 4.30142C16.9071 3.77805 15.9638 3.49974 15 3.5C14.7348 3.5 14.4804 3.60536 14.2929 3.79289C14.1054 3.98043 14 4.23478 14 4.5C14 4.76522 14.1054 5.01957 14.2929 5.20711C14.4804 5.39464 14.7348 5.5 15 5.5C15.7956 5.5 16.5587 5.81607 17.1213 6.37868C17.6839 6.94129 18 7.70435 18 8.5C17.9986 9.02524 17.8593 9.5409 17.5961 9.99542C17.3328 10.4499 16.9549 10.8274 16.5 11.09C16.3517 11.1755 16.2279 11.2977 16.1404 11.4447C16.0528 11.5918 16.0045 11.7589 16 11.93C15.9958 12.0998 16.0349 12.2678 16.1137 12.4183C16.1924 12.5687 16.3081 12.6967 16.45 12.79L16.84 13.05L16.97 13.12C18.1754 13.6917 19.1923 14.596 19.901 15.7263C20.6096 16.8566 20.9805 18.1659 20.97 19.5C20.97 19.7652 21.0754 20.0196 21.2629 20.2071C21.4504 20.3946 21.7048 20.5 21.97 20.5C22.2352 20.5 22.4896 20.3946 22.6771 20.2071C22.8646 20.0196 22.97 19.7652 22.97 19.5C22.9782 17.9654 22.5938 16.4543 21.8535 15.1101C21.1131 13.7659 20.0413 12.6333 18.74 11.82Z"
                fill="black"
              />
            </svg>
          </button>
          <p>En ligne : {{ userOnlineArray?.length }}</p>
        </div>
      </ng-template>
    </div>
  </div>

  <div class="room-discussion {{ currentRoom && isConnect ? '' : 'empty' }}">
    <div class="button-container" *ngIf="currentRoom && isConnect">
      <button
        class="square add-user"
        title="Ajouter un ami"
        *ngIf="currentRoom.isGroup"
      >
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M21 10.5H20V9.5C20 9.23478 19.8946 8.98043 19.7071 8.79289C19.5196 8.60536 19.2652 8.5 19 8.5C18.7348 8.5 18.4804 8.60536 18.2929 8.79289C18.1054 8.98043 18 9.23478 18 9.5V10.5H17C16.7348 10.5 16.4804 10.6054 16.2929 10.7929C16.1054 10.9804 16 11.2348 16 11.5C16 11.7652 16.1054 12.0196 16.2929 12.2071C16.4804 12.3946 16.7348 12.5 17 12.5H18V13.5C18 13.7652 18.1054 14.0196 18.2929 14.2071C18.4804 14.3946 18.7348 14.5 19 14.5C19.2652 14.5 19.5196 14.3946 19.7071 14.2071C19.8946 14.0196 20 13.7652 20 13.5V12.5H21C21.2652 12.5 21.5196 12.3946 21.7071 12.2071C21.8946 12.0196 22 11.7652 22 11.5C22 11.2348 21.8946 10.9804 21.7071 10.7929C21.5196 10.6054 21.2652 10.5 21 10.5ZM13.3 12.22C13.8336 11.7581 14.2616 11.1869 14.5549 10.545C14.8482 9.90316 15 9.20571 15 8.5C15 7.17392 14.4732 5.90215 13.5355 4.96447C12.5979 4.02678 11.3261 3.5 10 3.5C8.67392 3.5 7.40215 4.02678 6.46447 4.96447C5.52678 5.90215 5 7.17392 5 8.5C4.99999 9.20571 5.1518 9.90316 5.44513 10.545C5.73845 11.1869 6.16642 11.7581 6.7 12.22C5.30014 12.8539 4.11247 13.8775 3.27898 15.1685C2.4455 16.4596 2.00147 17.9633 2 19.5C2 19.7652 2.10536 20.0196 2.29289 20.2071C2.48043 20.3946 2.73478 20.5 3 20.5C3.26522 20.5 3.51957 20.3946 3.70711 20.2071C3.89464 20.0196 4 19.7652 4 19.5C4 17.9087 4.63214 16.3826 5.75736 15.2574C6.88258 14.1321 8.4087 13.5 10 13.5C11.5913 13.5 13.1174 14.1321 14.2426 15.2574C15.3679 16.3826 16 17.9087 16 19.5C16 19.7652 16.1054 20.0196 16.2929 20.2071C16.4804 20.3946 16.7348 20.5 17 20.5C17.2652 20.5 17.5196 20.3946 17.7071 20.2071C17.8946 20.0196 18 19.7652 18 19.5C17.9985 17.9633 17.5545 16.4596 16.721 15.1685C15.8875 13.8775 14.6999 12.8539 13.3 12.22ZM10 11.5C9.40666 11.5 8.82664 11.3241 8.33329 10.9944C7.83994 10.6648 7.45542 10.1962 7.22836 9.64805C7.0013 9.09987 6.94189 8.49667 7.05764 7.91473C7.1734 7.33279 7.45912 6.79824 7.87868 6.37868C8.29824 5.95912 8.83279 5.6734 9.41473 5.55764C9.99667 5.44189 10.5999 5.5013 11.1481 5.72836C11.6962 5.95542 12.1648 6.33994 12.4944 6.83329C12.8241 7.32664 13 7.90666 13 8.5C13 9.29565 12.6839 10.0587 12.1213 10.6213C11.5587 11.1839 10.7956 11.5 10 11.5Z"
            fill="black"
          />
        </svg>
      </button>
      <button
        class="square leave-room"
        title="Quitter"
        (click)="updateRoom('remove user', currentRoom, currentUser)"
      >
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M12 18.25C11.5858 18.25 11.25 18.5858 11.25 19C11.25 19.4142 11.5858 19.75 12 19.75H18C18.9665 19.75 19.75 18.9665 19.75 18V6C19.75 5.0335 18.9665 4.25 18 4.25H12C11.5858 4.25 11.25 4.58579 11.25 5C11.25 5.41421 11.5858 5.75 12 5.75L18 5.75C18.1381 5.75 18.25 5.86193 18.25 6L18.25 18C18.25 18.1381 18.1381 18.25 18 18.25H12Z"
            fill="black"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M14.5031 14.3652C15.1934 14.3652 15.7531 13.8056 15.7531 13.1152V10.8747C15.7531 10.1843 15.1934 9.6247 14.5031 9.6247L9.89048 9.6247C9.88396 9.55128 9.87713 9.47787 9.87 9.40448L9.81597 8.8486C9.73354 8.00049 8.83294 7.49258 8.06451 7.86084C6.43029 8.64403 4.95085 9.71578 3.69736 11.0245L3.59816 11.1281C3.13395 11.6128 3.13395 12.3771 3.59815 12.8618L3.69736 12.9654C4.95085 14.2741 6.43029 15.3459 8.06451 16.1291C8.83293 16.4973 9.73354 15.9894 9.81597 15.1413L9.87 14.5854C9.87713 14.512 9.88396 14.4386 9.89048 14.3652H14.5031ZM9.19511 12.8652C8.92874 12.8652 8.69326 13.0045 8.56008 13.216C8.49523 13.319 8.45464 13.4391 8.44656 13.5685C8.42842 13.8594 8.40524 14.15 8.37703 14.4403L8.36135 14.6017C7.3253 14.0677 6.36316 13.4028 5.49838 12.6239C5.27402 12.4218 5.05622 12.2121 4.84538 11.995C5.86892 10.9409 7.05651 10.0607 8.36135 9.38824L8.37703 9.54959C8.40524 9.83987 8.42842 10.1305 8.44656 10.4214C8.47122 10.8167 8.79902 11.1247 9.19511 11.1247H14.2531V12.8652H9.19511Z"
            fill="black"
          />
        </svg>
      </button>
    </div>
    <div class="messages-container" *ngIf="currentRoom && isConnect">
      <div
        class="message {{ item.id === currentUser.id ? 'end' : 'start' }}"
        *ngFor="let item of messageArray"
      >
        <img
          src="assets/avatar.png"
          alt="{{ item.name }}"
          title="{{ item.name }}"
        />
        <div class="text-container">
          <div class="title">
            <h4>{{ item.name }}</h4>
            <p>15:10</p>
          </div>
          <p>{{ item.message }}</p>
        </div>
      </div>
    </div>
    <div class="input-container" *ngIf="currentRoom && isConnect">
      <p class="user-is-writing" *ngIf="writingUser">
        {{ writingUser.name }}Test est en train d'écrire...
      </p>
      <input
        type="text"
        [(ngModel)]="message"
        (keyup)="$event.keyCode == 13 && sendMessage()"
        (ngModelChange)="setUserIsWritingHandler()"
      />
      <button (click)="sendMessage()">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M21.75 12C21.75 12.2724 21.6023 12.5233 21.3642 12.6556L19.0819 13.9236C14.5705 16.4299 9.81474 18.4687 4.88879 20.008L4.22371 20.2159C3.99598 20.287 3.74798 20.2456 3.55575 20.1043C3.36352 19.9629 3.25 19.7386 3.25 19.5L3.25 13.75C3.25 13.359 3.55041 13.0336 3.94019 13.0024L4.16752 12.9842C6.31898 12.8121 8.45387 12.4829 10.5552 11.9997C8.42436 11.5098 6.25902 11.1782 4.0769 11.0083L3.94175 10.9977C3.55131 10.9673 3.25 10.6416 3.25 10.25L3.25 4.50001C3.25 4.26142 3.36352 4.03706 3.55575 3.89574C3.74798 3.75441 3.99598 3.71298 4.22371 3.78415L4.88878 3.99198C9.81474 5.53134 14.5705 7.57008 19.0819 10.0764L21.3642 11.3444C21.6023 11.4767 21.75 11.7276 21.75 12ZM19.4557 12L18.3534 11.3877C14.0256 8.98333 9.46847 7.01801 4.75 5.52089L4.75 9.55957C7.68008 9.82384 10.5783 10.3702 13.4043 11.1912L13.7092 11.2798C14.0299 11.3729 14.2503 11.6668 14.25 12.0007C14.2497 12.3346 14.0287 12.6281 13.7078 12.7206L13.3173 12.8333C10.5188 13.6404 7.65003 14.1784 4.75 14.44L4.75 18.4791C9.46846 16.982 14.0256 15.0167 18.3534 12.6124L19.4557 12Z"
            fill="black"
          />
        </svg>
      </button>
    </div>
    <h4 *ngIf="!currentRoom && isConnect" class="empty-room">
      Il n'y a rien à afficher
    </h4>
    <h4 *ngIf="!isConnect" class="empty-room">Vous n'êtes pas connecté</h4>
  </div>
</div>

<div
  class="modal-overlay"
  *ngIf="createGroupButton"
  (click)="displayGroupInputHandler($event)"
>
  <div class="modal">
    <div class="input-container">
      <h4>Nom du groupe</h4>
      <input type="text" [(ngModel)]="groupNameInput" />
    </div>
    <div class="user-container">
      <div *ngFor="let user of userSelectedForGroup">
        <app-chatuser [user]="user" [hoverEffect]="false"></app-chatuser>
      </div>
    </div>
    <div class="button-container">
      <button
        class="validate"
        title="Valider"
        (click)="createRoom(userSelectedForGroup, true, groupNameInput)"
      >
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M18.0303 7.96967C18.3232 8.26256 18.3232 8.73744 18.0303 9.03033L11.0303 16.0303C10.7374 16.3232 10.2626 16.3232 9.96967 16.0303L5.96967 12.0303C5.67678 11.7374 5.67678 11.2626 5.96967 10.9697C6.26256 10.6768 6.73744 10.6768 7.03033 10.9697L10.5 14.4393L16.9697 7.96967C17.2626 7.67678 17.7374 7.67678 18.0303 7.96967Z"
            fill="black"
          />
        </svg>
      </button>
      <a class="cancel" title="Annuler" (click)="displayGroupInputHandler()">
        Annuler
      </a>
    </div>
  </div>
</div>
